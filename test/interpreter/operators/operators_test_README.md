# 河图脚本语言运算符测试套件

这个测试套件专门用于测试河图脚本语言的运算符实现是否符合预期。测试套件覆盖了所有支持的运算符类型和优先级。

## 测试文件

- `hetu_operators_complete_test.dart` - 完整的运算符测试套件
- `comprehensive_operators_test.dart` - 详细的运算符测试（包含更多边界情况）

## 测试覆盖的运算符类型

### 1. 运算符优先级测试

- 算术运算符优先级 (`*`, `/` 高于 `+`, `-`)
- 括号优先级覆盖
- 一元运算符优先级

### 2. 算术运算符

- 基本算术运算：`+`, `-`, `*`, `/`, `%`
- 整数除法：`~/`
- 负数运算

### 3. 位运算符

- 按位与：`&`
- 按位或：`|`
- 按位异或：`^`
- 位移：`<<`, `>>`, `>>>`

### 4. 比较运算符

- 关系运算符：`>`, `<`, `>=`, `<=`
- 相等运算符：`==`, `!=`
- 字符串比较（部分支持）

### 5. 逻辑运算符

- 逻辑与：`&&`
- 逻辑或：`||`
- 逻辑非：`!`
- 短路求值验证

### 6. 空值运算符

- 空合并运算符：`??`
- 空合并赋值：`??=`
- 可空成员访问：`?.`
- 可空方法调用：`?.()`
- 可空链式调用

### 7. 三元运算符

- 基本三元运算：`condition ? true_value : false_value`
- 嵌套三元运算

### 8. 赋值运算符

- 复合赋值：`+=`, `-=`, `*=`, `/=`, `~/=`

### 9. 自增自减运算符

- 前置自增：`++var`
- 后置自增：`var++`
- 前置自减：`--var`
- 后置自减：`var--`

### 10. 成员访问运算符

- 点运算符：`object.property`
- 下标运算符：`array[index]`, `map[key]`
- 方法调用：`object.method()`

### 11. 类型测试运算符

- `is` 运算符：类型检查
- `is!` 运算符：类型否定检查

### 12. 展开运算符

- 函数调用中的展开：`func(...args)`
- 列表字面量中的展开：`[...list1, ...list2]`
- 结构体字面量中的展开：`{...struct1, ...struct2}`

### 13. 复杂表达式测试

- 多种运算符组合的表达式
- 复杂赋值与成员访问
- 链式空值检查

### 14. 边界情况测试

- 除零处理
- 深层表达式嵌套
- 类型不匹配运算
- 布尔运算

## 运算符优先级表

根据河图脚本语言文档，运算符优先级从高到低排列：

| 优先级 | 描述     | 运算符                                               | 结合性 |
| ------ | -------- | ---------------------------------------------------- | ------ |
| 16     | 后缀一元 | `e.`, `e?.`, `e++`, `e--`, `e1[e2]`, `e()`           | 无     |
| 15     | 前缀一元 | `-e`, `!e`, `++e`, `--e`, `await e`                  | 无     |
| 14     | 乘法     | `*`, `/`, `~/`, `%`                                  | 左结合 |
| 13     | 加法     | `+`, `-`                                             | 左结合 |
| 12     | 位移     | `<<`, `>>`, `>>>`                                    | 左结合 |
| 11     | 按位与   | `&`                                                  | 左结合 |
| 10     | 按位异或 | `^`                                                  | 左结合 |
| 9      | 按位或   | `\|`                                                 | 左结合 |
| 8      | 关系     | `<`, `>`, `<=`, `>=`, `as`, `is`, `is!`, `in`, `in!` | 无     |
| 7      | 相等     | `==`, `!=`                                           | 无     |
| 6      | 逻辑与   | `&&`                                                 | 左结合 |
| 5      | 逻辑或   | `\|\|`                                               | 左结合 |
| 4      | 空合并   | `??`                                                 | 左结合 |
| 3      | 三元     | `e1 ? e2 : e3`                                       | 右结合 |
| 1      | 赋值     | `=`, `*=`, `/=`, `~/=`, `+=`, `-=`, `??=`            | 右结合 |
| 0      | 展开     | `...`                                                | 无     |

## 运行测试

```bash
# 运行完整测试套件
dart test test/interpreter/hetu_operators_complete_test.dart
```

## 注意事项

1. **字符串比较**：河图脚本可能不支持字符串的大小比较运算符（`>`, `<`）
2. **类型转换**：字符串和数字不能直接相加，会抛出类型错误
3. **除零处理**：除零运算返回 `Infinity` 而不是抛出异常
4. **逻辑运算符优先级**：河图运算符在设计上应该完全和 Dart 的行为一致
5. **短路求值**：逻辑运算符支持短路求值，避免不必要的副作用

## 测试结果

所有测试都应该通过，如果有测试失败，可能表明：

- 河图脚本语言的运算符实现有问题
- 运算符优先级与预期不符
- 某些运算符组合不被支持
- 类型系统的限制

这个测试套件提供了一个全面的基准，可以用来验证河图脚本语言运算符的正确性和一致性。
